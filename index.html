import React, { useState, useEffect, useRef } from 'react';
import { Search, GraduationCap, Users, School, Briefcase, Sparkles, Lock, User, LogOut, Upload, Zap, ShieldCheck, X, FileText, ExternalLink, Globe, Database } from 'lucide-react';

// --- DATA PTK ---
const pendidikData = [
  { id: 1, name: "Ali Sadikin", gender: "male", role: "Guru Mapel", linkDrive1: "https://drive.google.com/file/d/15hYg-n9D3TNA2SPKQJ7Kzt_qNyiJDwAf/view?usp=drive_link", linkDrive2: "https://docs.google.com/spreadsheets/d/1PLDjxhdd_R8gjpQovB4PRICBh12m4M4U/edit?usp=drive_link&ouid=108695109185601320347&rtpof=true&sd=true" },
  { id: 2, name: "Arief Kurniawan", gender: "male", role: "Guru Mapel", linkDrive1: "https://drive.google.com/file/d/1uBpzQsQBt8I5G00AbQGOKYZrbZXb19Uv/view?usp=drive_link", linkDrive2: "https://docs.google.com/spreadsheets/d/1OgOaivkFoBprAXn_zLfYDPk6DnnFq4Ji/edit?usp=drive_link&ouid=108695109185601320347&rtpof=true&sd=true" },
  { id: 3, name: "Atin Septiasari", gender: "female", role: "Guru Mapel", linkDrive1: "https://drive.google.com/file/d/1-iv0dO_KuubNRn9tfy87oxkktjc7bw_W/view?usp=drive_link", linkDrive2: "https://docs.google.com/spreadsheets/d/1bUNmQHXfIeBb_2CTxp2c2jtytr46Y0aE/edit?usp=drive_link&ouid=108695109185601320347&rtpof=true&sd=true" },
  { id: 4, name: "Fadlan Zulianto R", gender: "male", role: "Guru Mapel", linkDrive1: "https://drive.google.com/file/d/1PscfKyXyhiRQy8HMBO8uQ2QehyaRH4Gb/view?usp=drive_link", linkDrive2: "https://docs.google.com/spreadsheets/d/1kzgk2vTQMic0JzGbzkLknlwu0EOenSq5/edit?usp=drive_link&ouid=108695109185601320347&rtpof=true&sd=true" },
  { id: 5, name: "Heni Faridanti A", gender: "female", role: "Guru Mapel", linkDrive1: "https://drive.google.com/file/d/1PAJpO4hhHiMWMeD9zcFDPgWzEktOGa9k/view?usp=drive_link", linkDrive2: "https://docs.google.com/spreadsheets/d/1xjoceKIwJDq40dAzC82_I9iWB_BPkkez/edit?usp=drive_link&ouid=108695109185601320347&rtpof=true&sd=true" },
  { id: 6, name: "Ina Solikhati", gender: "female", role: "Guru Mapel", linkDrive1: "https://drive.google.com/file/d/1m64XbJx0F_OwhoccdCtj6Vqg8lzlwqAA/view?usp=drive_link", linkDrive2: "https://docs.google.com/spreadsheets/d/17Js5S6mfHlJxBwquRgEA3u0PSnigh95f/edit?usp=drive_link&ouid=108695109185601320347&rtpof=true&sd=true" },
  { id: 7, name: "Isti Kharirotun N", gender: "female", role: "Guru Mapel", linkDrive1: "https://drive.google.com/file/d/1FUlKHEQkdpcrXHDDcyEYmkrcHKuf_tpB/view?usp=drive_link", linkDrive2: "https://docs.google.com/spreadsheets/d/1qDhlrvB3KvWf-zdLOiLmFGB40E8dPwIk/edit?usp=drive_link&ouid=108695109185601320347&rtpof=true&sd=true" },
  { id: 8, name: "M Mukhamim", gender: "male", role: "Guru Mapel", linkDrive1: "https://drive.google.com/file/d/1sumFIb05GLTZabI8aWtY8CubLTJitEo6/view?usp=drive_link", linkDrive2: "https://docs.google.com/spreadsheets/d/10b7M7s_LL9wddg-NZvUsv-0N9kdwAx8X/edit?usp=drive_link&ouid=108695109185601320347&rtpof=true&sd=true" },
  { id: 9, name: "Mukhlison", gender: "male", role: "Guru Mapel", linkDrive1: "https://drive.google.com/file/d/10YTF0NgdstDKZs7l6AqmPQaIts3EPDN6/view?usp=drive_link", linkDrive2: "https://docs.google.com/spreadsheets/d/172-hC2oWqEaq9xvOn68ImO3ZrhjzJxHm/edit?usp=drive_link&ouid=108695109185601320347&rtpof=true&sd=true" },
  { id: 10, name: "Musngidul Umam", gender: "male", role: "Guru Mapel", linkDrive1: "https://drive.google.com/file/d/1uIkDnIg7FJOKj8jUhY7iH5rJPDvkCklK/view?usp=drive_link", linkDrive2: "https://docs.google.com/spreadsheets/d/1F7PoLFVEo9N-D4cNYNcoxnlXl8jawdYU/edit?usp=drive_link&ouid=108695109185601320347&rtpof=true&sd=true" },
  { id: 11, name: "Nurkhalimah", gender: "female", role: "Guru Mapel", linkDrive1: "https://drive.google.com/file/d/1AgW0MFKjtJCo_sR6Q4T6dKIj25JGPbV6/view?usp=drive_link", linkDrive2: "https://docs.google.com/spreadsheets/d/1yPqJciKDYT6j25PDI8ryuas23bOZpMcv/edit?usp=drive_link&ouid=108695109185601320347&rtpof=true&sd=true" },
  { id: 12, name: "Oktina Laili H", gender: "female", role: "Guru Mapel", linkDrive1: "https://drive.google.com/file/d/1tfDslQfXu2czNt0gX5WTYUAHSCTTQQRp/view?usp=drive_link", linkDrive2: "https://docs.google.com/spreadsheets/d/1kP8MrPuZi1eMkkKN2luMb_0kV7bR9YgG/edit?usp=drive_link&ouid=108695109185601320347&rtpof=true&sd=true" },
  { id: 13, name: "Putri Lailatus S", gender: "female", role: "Guru Mapel", linkDrive1: "https://drive.google.com/file/d/1zs2XH7f7KD6uM-RasG8Ado7BIQAyYUDH/view?usp=drive_link", linkDrive2: "https://docs.google.com/spreadsheets/d/1NEdNEj7qp3GvXGw-bKH6Ag8bvhN8K4V4/edit?usp=drive_link&ouid=108695109185601320347&rtpof=true&sd=true" },
  { id: 14, name: "Robi Irsa'ni", gender: "male", role: "Guru Mapel", linkDrive1: "https://drive.google.com/file/d/1wkk7bLGkPzzgYEwZi1zTPHpdoUbyvHQ3/view?usp=drive_link", linkDrive2: "https://docs.google.com/spreadsheets/d/1wvziuNE7m27e6JdM1F3gd7Yw37cR3Cny/edit?usp=drive_link&ouid=108695109185601320347&rtpof=true&sd=true" },
  { id: 15, name: "Salsabila Nur A", gender: "female", role: "Guru Mapel", linkDrive1: "https://drive.google.com/file/d/1pRY76olbd1pKY1rwkJvXbEbj3eBcta6c/view?usp=drive_link", linkDrive2: "https://docs.google.com/spreadsheets/d/1kSmJ9CG286r6T1cNpV-JPL2edMMk9R30/edit?usp=drive_link&ouid=108695109185601320347&rtpof=true&sd=true" },
  { id: 16, name: "Selvi Wulan Sari", gender: "female", role: "Guru Mapel", linkDrive1: "https://drive.google.com/file/d/18yGI8xK0DNMLto9ip9dqpBbN7V2oWTrL/view?usp=drive_link", linkDrive2: "https://docs.google.com/spreadsheets/d/1-fUmsgS_ic9SUSFRBz0-AWPJ36gc21sr/edit?usp=drive_link&ouid=108695109185601320347&rtpof=true&sd=true" },
  { id: 17, name: "Syihabudin", gender: "male", role: "Guru Mapel", linkDrive1: "https://drive.google.com/file/d/1wg1oJucgvhg_eEnXrXw3copXIXENs8NR/view?usp=drive_link", linkDrive2: "https://docs.google.com/spreadsheets/d/1N8ckPKYkAN2CflShRHcJV3SxaSGrJmXT/edit?usp=drive_link&ouid=108695109185601320347&rtpof=true&sd=true" },
  { id: 18, name: "Urip Ambaripto", gender: "male", role: "Guru Mapel", linkDrive1: "https://drive.google.com/file/d/1qJKwZR7jlRhciz87oOMR3XtU7bkS9fqC/view?usp=drive_link", linkDrive2: "https://docs.google.com/spreadsheets/d/1gX3U67RZTlFDCNXUZjM8sQl-MSBnyL6N/edit?usp=drive_link&ouid=108695109185601320347&rtpof=true&sd=true" },
  { id: 19, name: "Warsito", gender: "male", role: "Guru Mapel", linkDrive1: "https://drive.google.com/file/d/1qo8r1URzoARmj1S4qCD5UVdHfkO6nC0o/view?usp=drive_link", linkDrive2: "https://docs.google.com/spreadsheets/d/16R9e79xDWQI4h7Es_F3YvAZ4KndF5azy/edit?usp=drive_link&ouid=108695109185601320347&rtpof=true&sd=true" },
];

const tendikData = [
  { id: 101, name: "Ahmad Mutasir", gender: "male", role: "Staf Tata Usaha", linkDrive1: "https://drive.google.com/file/d/1eszcYyEs3pk9xR_alaX9n9k-fDSUmec6/view?usp=drive_link", linkDrive2: "https://docs.google.com/spreadsheets/d/1LGRf0rsA6e7jjcAcmoR13pFbO4cfwcoI/edit?usp=drive_link&ouid=108695109185601320347&rtpof=true&sd=true" },
  { id: 102, name: "Deka Ponco Saputro", gender: "male", role: "Staf Tata Usaha", linkDrive1: "https://drive.google.com/file/d/1VuRkzTo3uCxw0QTkJTf8aXKQGo4dzTKH/view?usp=drive_link", linkDrive2: "https://docs.google.com/spreadsheets/d/1-MqCNugPjVuCV0iFJvUNV0u8ho340Zjs/edit?usp=drive_link&ouid=108695109185601320347&rtpof=true&sd=true" },
  { id: 103, name: "Fadliyah", gender: "female", role: "Bendahara", linkDrive1: "https://drive.google.com/file/d/1LqOEMWbJSbaiYHjFy4jCh3XvuSFGN2eG/view?usp=drive_link", linkDrive2: "https://docs.google.com/spreadsheets/d/1tB_wnh0Ru64MaEp3fakk3guPxm4dZX9I/edit?usp=drive_link&ouid=108695109185601320347&rtpof=true&sd=true" },
  { id: 104, name: "Nuryati", gender: "female", role: "Staf Tata Usaha", linkDrive1: "https://drive.google.com/file/d/1WXX5IOhXgOrzhPWz9UbtebnVX8160Rd1/view?usp=drive_link", linkDrive2: "https://docs.google.com/spreadsheets/d/1Rq597d80Kov7kyj4lCnV3e6Ut7i7MPzD/edit?usp=drive_link&ouid=108695109185601320347&rtpof=true&sd=true" },
  { id: 105, name: "Saefulloh", gender: "male", role: "Keamanan", linkDrive1: "https://drive.google.com/file/d/13ZG-xbY3zA-5lSuRbew-FZoF5UXrT2l8/view?usp=drive_link", linkDrive2: "https://docs.google.com/spreadsheets/d/1WvC2g6T8MKul9DmdW3udWOpRl7gX46yj/edit?usp=drive_link&ouid=108695109185601320347&rtpof=true&sd=true" },
];

const Silhouette = ({ gender }) => (
  <svg viewBox="0 0 24 24" fill="currentColor" className="w-full h-full text-slate-300">
    {gender === 'male' ? (
      <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
    ) : (
      <path d="M12 4c-2.21 0-4 1.79-4 4 0 1.78 1.17 3.28 2.8 3.81C7.73 12.89 6 15.24 6 18h12c0-2.76-1.73-5.11-4.8-6.19 1.63-.53 2.8-2.03 2.8-3.81 0-2.21-1.79-4-4-4z" />
    )}
  </svg>
);

const Modal = ({ person, onClose, scrollY }) => {
  if (!person) return null;

  const isMale = person.gender === 'male';
  const bgColor = isMale ? 'bg-indigo-50' : 'bg-rose-50';
  const parallaxY = (scrollY % 50) / 4; 

  return (
    <div className="fixed inset-0 z-[100] flex items-center justify-center p-4">
      <div 
        className="absolute inset-0 bg-slate-900/20 backdrop-blur-sm animate-in fade-in duration-300" 
        onClick={onClose}
      ></div>
      
      <div 
        style={{ transform: `translateY(${parallaxY}px)` }}
        className="relative bg-white w-full max-w-[320px] rounded-[2rem] overflow-hidden shadow-[0_30px_60px_rgba(0,0,0,0.12)] border border-slate-100 animate-in zoom-in-95 duration-300"
      >
        <div className="p-6">
          <div className="flex items-start justify-between mb-4">
            <div className={`w-12 h-12 rounded-2xl ${bgColor} flex items-center justify-center`}>
              <div className="w-8 h-8 opacity-80">
                <Silhouette gender={person.gender} />
              </div>
            </div>
            <button 
              onClick={onClose} 
              className="p-2 hover:bg-slate-100 text-slate-400 rounded-full transition-colors"
            >
              <X size={18} />
            </button>
          </div>

          <div className="mb-6">
            <h2 className="text-lg font-black text-slate-900 leading-tight">{person.name}</h2>
          </div>
          
          <div className="grid grid-cols-2 gap-3">
            <a href={person.linkDrive1} target="_blank" rel="noopener noreferrer" 
               className="flex flex-col items-center gap-2 p-3 bg-slate-50 hover:bg-white border border-slate-100 hover:border-indigo-200 rounded-2xl transition-all group">
              <Globe size={16} className="text-indigo-500 group-hover:scale-110 transition-transform" />
              <span className="text-[8px] font-black uppercase tracking-tighter text-slate-500">Profil Utama</span>
            </a>

            <a href={person.linkDrive2} target="_blank" rel="noopener noreferrer" 
               className="flex flex-col items-center gap-2 p-3 bg-slate-50 hover:bg-white border border-slate-100 hover:border-emerald-200 rounded-2xl transition-all group">
              <Database size={16} className="text-emerald-500 group-hover:scale-110 transition-transform" />
              <span className="text-[8px] font-black uppercase tracking-tighter text-slate-500">Arsip Digital</span>
            </a>
          </div>
          
          <div className="mt-6 pt-4 border-t border-slate-50 flex items-center justify-center">
             <div className="flex items-center gap-1.5 opacity-30">
                <ShieldCheck size={10} />
                <span className="text-[7px] font-bold uppercase tracking-[0.2em]">Verified PTK 2026</span>
             </div>
          </div>
        </div>
      </div>
    </div>
  );
};

const ModernCard = ({ person, onSelect }) => {
  const isMale = person.gender === 'male';
  const grad = isMale ? 'from-indigo-600 to-blue-500' : 'from-rose-500 to-pink-500';

  return (
    <div 
      className="group cursor-pointer" 
      onClick={() => onSelect(person)}
    >
      <div className="relative bg-white rounded-[2.5rem] p-6 transition-all duration-500 hover:-translate-y-2 shadow-sm hover:shadow-xl border border-slate-50 flex flex-col items-center">
        <div className={`w-20 h-20 rounded-[1.8rem] p-1 bg-gradient-to-br ${grad} mb-4 transition-transform group-hover:rotate-3`}>
          <div className="w-full h-full bg-white rounded-2xl overflow-hidden flex items-center justify-center">
            <div className="w-10 h-10 opacity-60">
              <Silhouette gender={person.gender} />
            </div>
          </div>
        </div>
        <h3 className="text-[13px] font-black text-slate-800 text-center leading-tight group-hover:text-indigo-600">
          {person.name}
        </h3>
      </div>
    </div>
  );
};

export default function App() {
  const [isLoggedIn, setIsLoggedIn] = useState(false);
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const [loginError, setLoginError] = useState('');
  const [activeTab, setActiveTab] = useState('pendidik');
  const [searchTerm, setSearchTerm] = useState('');
  const [selectedPerson, setSelectedPerson] = useState(null);
  const [scrollY, setScrollY] = useState(0);
  
  useEffect(() => {
    const handleScroll = () => setScrollY(window.scrollY);
    window.addEventListener('scroll', handleScroll, { passive: true });
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  const handleLogin = (e) => {
    e.preventDefault();
    if (username === "20300486" && password === "20300486") {
      setIsLoggedIn(true);
    } else {
      setLoginError('Kredensial salah.');
    }
  };

  const displayedData = activeTab === 'pendidik' ? pendidikData : tendikData;
  const filteredData = displayedData.filter(p => p.name.toLowerCase().includes(searchTerm.toLowerCase()));

  if (!isLoggedIn) {
    return (
      <div className="min-h-screen bg-[#F3F7FA] flex items-center justify-center p-6 font-sans">
        <div className="w-full max-w-[380px] bg-white rounded-[3rem] shadow-xl p-10 border border-white">
          <div className="flex flex-col items-center mb-10 text-center">
            <div className="w-16 h-16 bg-indigo-600 rounded-2xl flex items-center justify-center text-white shadow-lg mb-6">
              <School size={30} />
            </div>
            <h2 className="text-2xl font-black tracking-tighter">Admin Portal</h2>
          </div>
          <form onSubmit={handleLogin} className="space-y-4">
            <input type="text" placeholder="Username" value={username} onChange={e => setUsername(e.target.value)} className="w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl font-bold outline-none focus:ring-2 focus:ring-indigo-100 transition-all text-sm" />
            <input type="password" placeholder="Password" value={password} onChange={e => setPassword(e.target.value)} className="w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl font-bold outline-none focus:ring-2 focus:ring-indigo-100 transition-all text-sm" />
            {loginError && <p className="text-rose-500 text-[10px] font-black text-center">{loginError}</p>}
            <button className="w-full py-4 bg-indigo-600 text-white rounded-2xl font-black uppercase tracking-[0.2em] text-[10px] hover:bg-indigo-700 transition-all shadow-lg active:scale-95">Masuk Sistem</button>
          </form>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-[#F8FAFF] pb-20">
      {selectedPerson && (
        <Modal person={selectedPerson} scrollY={scrollY} onClose={() => setSelectedPerson(null)} />
      )}

      <header className="p-4 max-w-7xl mx-auto sticky top-0 z-40">
        <div className="bg-white/80 backdrop-blur-xl rounded-[2rem] p-4 shadow-sm border border-white/50 flex items-center justify-between">
          <div className="flex items-center gap-4 px-2">
            <div className="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-white shadow-md">
              <School size={20} />
            </div>
            <h1 className="text-sm font-black tracking-tight text-slate-900 hidden sm:block">SMP Diponegoro Sampang</h1>
          </div>
          <button onClick={() => setIsLoggedIn(false)} className="px-4 py-2 text-rose-500 font-black text-[9px] uppercase tracking-widest hover:bg-rose-50 rounded-xl transition-all">
            Logout
          </button>
        </div>
      </header>

      <main className="max-w-7xl mx-auto px-6 mt-12">
        <div className="text-center mb-16">
          <h2 className="text-4xl font-black tracking-tighter text-slate-900">Data <span className="text-indigo-600">Personil</span></h2>
          <p className="text-slate-400 font-bold text-sm mt-4">Sistem Manajemen Terpadu PTK</p>
        </div>

        <div className="flex flex-col md:flex-row gap-4 mb-12">
          <div className="flex p-1.5 bg-white rounded-2xl border border-slate-100 shadow-sm grow-0">
            {['pendidik', 'tendik'].map(t => (
              <button key={t} onClick={() => setActiveTab(t)} className={`px-6 py-3 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${activeTab === t ? 'bg-indigo-600 text-white' : 'text-slate-400 hover:text-slate-600'}`}>
                {t === 'pendidik' ? 'Guru' : 'Staf'}
              </button>
            ))}
          </div>
          <div className="relative grow">
            <Search className="absolute left-6 top-1/2 -translate-y-1/2 text-slate-300" size={20} />
            <input type="text" placeholder="Cari personil..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} className="w-full pl-14 pr-6 py-4 bg-white border border-slate-100 rounded-2xl font-bold outline-none shadow-sm focus:border-indigo-200 transition-all text-sm" />
          </div>
        </div>

        <div className="grid grid-cols-1 xs:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
          {filteredData.map(p => (
            <ModernCard key={p.id} person={p} onSelect={setSelectedPerson} />
          ))}
        </div>
      </main>

      <style>{`
        @keyframes zoom-in { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .animate-in { animation: 0.3s cubic-bezier(0.16, 1, 0.3, 1) both; }
        .fade-in { animation-name: fade-in-anim; }
        @keyframes fade-in-anim { from { opacity: 0; } to { opacity: 1; } }
        .zoom-in-95 { animation-name: zoom-in; }
      `}</style>
    </div>
  );
}